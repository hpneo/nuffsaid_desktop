var Inflecta = require('inflecta'),
    Coffre = require('./index'),
    Relation = require('./relation');
var Associations = {};

Associations.hasMany = function(tableName, options) {
  options = options || {};

  var propertyModel = Coffre.mappedModels[Inflecta.tableize(tableName)] || options['model'],
      propertyName = options['as'] || tableName;

  this.associations.hasMany[tableName] = {
    model: propertyModel,
    as: propertyName
  };

  Object.defineProperty(this.prototype, propertyName, {
    configurable: false,
    enumerable: true,
    get: function() {
      if (this.associations.hasMany[tableName] === undefined) {
        this.associations.hasMany[tableName] = new Relation();
      }

      return this.associations.hasMany[tableName];
    }
  });
};

Associations.belongsTo = function(tableName, options) {
  options = options || {};

  var propertyModel = Coffre.mappedModels[Inflecta.tableize(tableName)] || options['model'],
      propertyName = options['as'] || tableName;

  this.associations.belongsTo[tableName] = {
    model: propertyModel,
    as: propertyName
  };

  Object.defineProperty(this.prototype, propertyName, {
    configurable: false,
    enumerable: true,
    get: function() {
      if (this.associations.belongsTo[tableName] === undefined) {
        this.associations.belongsTo[tableName] = new Relation();
      }

      return this.associations.belongsTo[tableName];
    }
  });
};

module.exports = Associations;